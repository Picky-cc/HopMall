define(function(require,exports,module){var e=require("baseView/baseFormView"),t=e.FieldsetView,i=require("component/dialogView"),a=jQuery,r=t.extend({events:{"change .real-value":"onChange"},initialize:function(e){var t=this;this.sourceModel=e.sourceModel,this.sourceModel.on("contractdate:lack",function(){t.$(".beginend-datepicker .imitate-datetimepicker-input").addClass("error")}),this.initDialog()},initDialog:function(){var e=this,t=e.$(".beginend-datepicker"),a=this.wrongDialogView=new i({bodyInnerTxt:"合同期限与缴租阶段日期冲突，是否清除所有缴租阶段重新填写？"}),r=!1;this.listenTo(a,"goahead",function(){e.trigger("payperiod:clear"),a.hide(),r=!0}).listenTo(a,"closedialog",function(){if(r)return void(r=!1);r=!1;var i=e.formerDate;if(i){var a=e.model.toJSON(),n=e.compareDate(i,a);e.model.set(n);var o=t.data("datepicker");n.effectiveTime&&o.updateStartDate(n.effectiveTime),n.maturityTime&&o.updateEndDate(n.maturityTime)}})},compareDate:function(e,t){var i={};for(var a in t)e[a]!==t[a]&&(i[a]=e[a]);return i},onChange:function(e){var t=e.target.name,i=e.target.value,a=this.sourceModel.paymentInfo.get("rentingIntervalList")||[];if(this.formerDate=this.model.toJSON(),this.model.set(t,i),i){if(a.length>0&&"effectiveTime"===t){var r=a[0];new Date(r.startDate)!==new Date(i)&&this.wrongDialogView.show()}else if(a.length>0&&"maturityTime"===t){var n=a[a.length-1];new Date(n.endDate)>new Date(i)&&this.wrongDialogView.show()}if("effectiveTime"===t){var o=new Date(i);o.setFullYear(o.getFullYear()+1),o.setDate(o.getDate()-1);var s=this.$(".endtime-datepicker"),l=o.format("yyyy-MM-dd");s.find("input").val(l),this.model.set("maturityTime",l)}}else a.length>0&&this.wrongDialogView.show()},validate:function(){var e=!0,t=this.$("[name=maturityTime]"),i=this.$("[name=issueTime]"),r=new Date(i.val()),n=new Date(t.val());if(r>n){e=!1;var o=a('<label id="issueTime_maturityTime_error" class="error" for="issueTime">合同签约日不能大于合同结束时间</label>');i.parents(".datetimepick-wrapper").after(o),i.parent().addClass("error"),t.parent().addClass("error")}else n>r&&(i.parent().removeClass("error"),t.parent().removeClass("error"),this.$("#issueTime_maturityTime_error").remove());return e}});module.exports=r});