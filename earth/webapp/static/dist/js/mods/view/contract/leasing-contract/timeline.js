define(function(require,exports,module){var t=jQuery,e=['    <div class="status-part">','        <div class="status-line"></div>',"    </div>"].join(""),s=['    <div class="status-part">','        <div class="status-note">','           <div class="status-left status-pre">','                <h4 class="font-bold exit-lease">退租</h4>','                <h5 class="status-left-time"></h5>',"           </div>",'           <a class="status-detail-href" href="">','               <div class="status-detail status-detail-left">','                  <h4><span class="exit-lease">退租:</span><span class="status-left-time"></span></h4>',"               </div>","           </a>","        </div>",'        <div class="status-line"></div>','        <div class="status-note">','           <div class="status-right status-pre">','                <h4 class="font-bold">租出</h4>','                <h5 class="status-right-time"></h5>',"           </div>",'           <a class="status-detail-href" href="">','               <div class="status-detail status-detail-right">','                   <h4><span class="font-bold lease-start"></span>&nbsp;&nbsp;<span>出租给:<span class="status-detail-name"></span></h4>','                   <h4>合同租期：<span class="status-time"></span></h4>',"               </div>","           </a>","        </div>","    </div>"].join(""),a=global_config.root,i=Backbone.View.extend({el:".static-info-wrapper",events:{"mouseover .rented-point":"onMouseoverShow","mouseover .status-pre":"onMousepreleaveShow","mouseleave .status-detail-gray":"onMouseleaveHide","click .create-leasing":"onClickCreate"},onClickCreate:function(t){},onMouseoverShow:function(t){var e=this.$(t.target);e.prev().children().length>1?(e.prev().find(".status-detail").show(),e.prev().find(".status-pre").hide()):(e.next().find(".status-detail").show(),e.next().find(".status-pre").hide())},onMousepreleaveShow:function(t){var e=this.$(t.currentTarget);e.next().find(".status-detail").show(),e.hide()},onMouseleaveHide:function(t){var e=this.$(t.currentTarget);e.prev().unbind(),e.parent().prev().show(),e.hide()},getConfig:function(){var e=JSON.parse(t("#contractRecordList").val());return e},initialize:function(){this.data=this.getConfig(),this.render(),this.$(".time-line-axis").children().length>0&&this.$(".time-line-wrapper").show(),this.setRentalrates()},render:function(){var t=this.data.businessContractInfo;this.addNorentalLine();for(var e=0;e<t.length;e++)"Executing"==t[e].contractLifeCycleEnum?(this.addGreenLeaseStatus(t[e].startDateStr,t[e].endDateStr,t[e].appendixRentername,t[e].businessContractUuid),this.addNorentalLine()):"Complete"==t[e].contractLifeCycleEnum?(this.addGreyLeaseStatus(t[e].startDateStr,t[e].retreatDateStr,t[e].endDateStr,t[e].appendixRentername,t[e].businessContractUuid),this.addNorentalLine()):""==t[e].contractLifeCycleEnum&&(this.addGreyLeaseStatus(t[e].startDateStr,"",t[e].endDateStr,t[e].appendixRentername,t[e].businessContractUuid),this.addNorentalLine())},addNorentalLine:function(){var s=t(e);s.find(".status-line").addClass("dashed-line"),t(".time-line-axis").append(s)},addRentalLine:function(){var s=t(e);s.find(".status-line").addClass("solid-line").height("50px"),t(".time-line-axis").append(s)},addGreenLeaseStatus:function(e,i,n,l){var d=e.split("-").join("/"),r=i.split("-").join("/"),o=a+"/business-contract/leasing-contract-view/"+l,u=new Date(d),h=new Date(r),f=new Date("2018/5/1"),c=(h.getTime()-f.getTime())/1728e5,p=(f.getTime()-u.getTime())/1728e5,m='<span class="point point-small point-dashed-green"></span>',v='<span class="point point-small point-green"></span>',g=t(s);g.find(".status-line").before(m).after(v),g.find(".status-detail-left").addClass("status-detail-green").find(".exit-lease").html("预计退租:"),g.find(".status-left-time").html(r),g.find(".status-detail-right").addClass("status-detail-green").find(".status-detail-name").html(n),g.find(".lease-start").html(d),g.find(".status-time").html(d+"-"+r),g.find(".status-pre").remove(),g.find(".status-line").addClass("solid-line solid-line-green").height(p+"px"),g.find(".status-line").before('<div class="status-line solid-line leftDate"></div>'),g.find(".leftDate").height(c+"px"),g.find(".status-detail-href").attr("href",o),t(".time-line-axis").append(g)},addGreyLeaseStatus:function(e,i,n,l,d){var r=e.split("-").join("/"),o=n.split("-").join("/"),u=i.split("-").join("/"),h=a+"/business-contract/leasing-contract-view/"+d,f=new Date(r),c=new Date(o),p=(c.getTime()-f.getTime())/1728e5,m=t(s),v='<span class="point point-small rented-point"></span>';m.find(".status-line").before(v).after(v).addClass("solid-line").height(p+"px"),m.find(".status-right-time").html(r),n>i?m.find(".exit-lease").html("提前退租"):""==u&&m.find(".exit-lease").html("预计退租"),m.find(".lease-start").html(r),m.find(".status-left-time").html(u),m.find(".status-detail-left").addClass("status-detail-gray"),m.find(".status-detail-right").addClass("status-detail-gray").find(".status-detail-name").html(l),m.find(".status-time").html(r+"-"+o),m.find(".status-detail-href").attr("href",h),t(".time-line-axis").append(m)},setStartEndtime:function(t,e){this.$(".endhouse-time").html(t),this.$(".gethouse-time").html(e)},setRentalrates:function(){for(var t=0,e=new Date(this.$(".endhouse-time").html()),s=new Date(this.$(".gethouse-time").html()),a=e.getTime()-s.getTime(),i=new Date("2019/5/1").getTime(),n=this.data.businessContractInfo,l=0;l<n.length;l++)if("Executing"==n[l].contractLifeCycleEnum){var d=n[l].startDate,r=i-d;t+=r}else{var o=n[l].retreatDate-n[l].startDate;t+=o}var u=parseInt(100*(t/a).toFixed(2));this.$(".rental-rates").html(u+"%")}});exports.TimelineView=i});