define(function(require,exports,module){var e=(require("component/popupTip"),require("component/fileUpload"),require("scaffold/util").validateUtil,require("baseView/baseFormView")),t=e.FieldsetView,a=e.SketchItemView,r=e.FormDialogView,i=jQuery,o=(global_const.root,{WATER_FARE:"subjectMatterAppendix.accountInfoMap.COURSEOFDEALING_LEASING_WATER_FEES",ELECTRIC_FARE:"subjectMatterAppendix.accountInfoMap.COURSEOFDEALING_LEASING_ELECTRICITY_FEES",HEATER_FARE:"subjectMatterAppendix.accountInfoMap.COURSEOFDEALING_LEASING_GAS_FEES"}),n=r.extend({id:"payTimeInputDialog",className:"modal fade form-modal",template:_.template(i("#editAccountInfoViewTmpl").html()||"",{variable:"obj"}),initialize:function(){n.__super__.initialize.apply(this,arguments),this.defineValidator()},defineValidator:function(){this.validator=this.$(".form").validate({rules:{accountNo:"required",accountOwnerName:"required",subbranch:"required"}})},validate:function(){return this.validator.form()},submitHandler:function(e){this.validate()&&(this.save(),this.hide())}}),d=a.extend({template:_.template(i("#itemAccountInfoViewTmpl").html()||""),toEdit:function(){var e=new n({model:this.model});e.show()}}),l=t.extend({el:i(".account-info"),events:{"click .btn-addfare":"onClickAddfare"},initialize:function(e){l.__super__.initialize.apply(this,arguments);var t=this.model.rGet(o.WATER_FARE);this.waterfareModel=new Backbone.Model(t),this.waterfareModel.set("type",o.WATER_FARE),this.listenTo(this.waterfareModel,"destroy",function(){this.$(".btn-waterfare").show(),this.waterfareModel.clear(),this.waterfareModel.set("type",o.WATER_FARE)}),t&&t.accountNo&&this.addWaterFare(this.waterfareModel);var a=this.model.rGet(o.HEATER_FARE);this.heaterfareModel=new Backbone.Model(a),this.heaterfareModel.set("type",o.HEATER_FARE),this.listenTo(this.heaterfareModel,"destroy",function(){this.$(".btn-heaterfare").show(),this.heaterfareModel.clear(),this.heaterfareModel.set("type",o.HEATER_FARE)}),a&&a.accountNo&&this.addHeaterfare(this.heaterfareModel);var r=this.model.rGet(o.ELECTRIC_FARE);this.electricfareModel=new Backbone.Model(r),this.electricfareModel.set("type",o.ELECTRIC_FARE),this.listenTo(this.electricfareModel,"destroy",function(){this.$(".btn-electricfare").show(),this.electricfareModel.clear(),this.electricfareModel.set("type",o.ELECTRIC_FARE)}),r&&r.accountNo&&this.addElectricfare(this.electricfareModel)},addfare:function(e){var t=new d({model:e}),a=t.render().$el;"COURSEOFDEALING_LEASING_WATER_FEES"==e.attributes.type?a.addClass("water"):"COURSEOFDEALING_LEASING_ELECTRICITY_FEES"==e.attributes.type?a.addClass("electric"):"COURSEOFDEALING_LEASING_GAS_FEES"==e.attributes.type&&a.addClass("gas"),this.$(".addfare").append(a)},onClickAddfare:function(e){var t=this,a=new Backbone.Model;a.once("change",function(e){var r=i(".fare-style").val();"水费"==r?a.set("type","COURSEOFDEALING_LEASING_WATER_FEES"):"电费"==r?a.set("type","COURSEOFDEALING_LEASING_ELECTRICITY_FEES"):"燃气费"==r&&a.set("type","COURSEOFDEALING_LEASING_GAS_FEES"),t.addfare(a)});var r=new n({model:a});r.show()},addWaterFare:function(e){var t=new d({model:e});this.$(".waterfare").append(t.render().$el),this.$(".btn-waterfare").hide()},onClickBtnWaterfare:function(e){var t=this,a=this.waterfareModel;a.once("change",function(e){t.addWaterFare(e)});var r=new n({model:a});r.show()},addHeaterfare:function(e){var t=new d({model:e});this.$(".heaterfare").append(t.render().$el),this.$(".btn-heaterfare").hide()},onClickBtnHeaterfare:function(e){var t=this,a=this.heaterfareModel;a.once("change",function(e){t.addHeaterfare(e)});var r=new n({model:a});r.show()},addElectricfare:function(e){var t=new d({model:e});this.$(".electricfare").append(t.render().$el),this.$(".btn-electricfare").hide()},onClickBtnElectricfare:function(e){var t=this,a=this.electricfareModel;a.once("change",function(e){t.addElectricfare(e)});var r=new n({model:a});r.show()},save:function(){var e=this.waterfareModel.toJSON(),t=this.heaterfareModel.toJSON(),a=this.electricfareModel.toJSON();e.accountNo?this.model.rSet(o.WATER_FARE,e):this.model.rUnset(o.WATER_FARE),t.accountNo?this.model.rSet(o.HEATER_FARE,t):this.model.rUnset(o.HEATER_FARE),a.accountNo?this.model.rSet(o.ELECTRIC_FARE,a):this.model.rUnset(o.ELECTRIC_FARE)}});module.exports=l});