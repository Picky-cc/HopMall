define(function(require,exports,module){var e=require("component/pagination"),i=require("component/popupTip"),o=require("./voucher-model").VoucherModel,t=require("baseView/baseFormView").FormDialogView,n=Backbone.View.extend({el:".content",events:{"click .onekey-writeoff":"onClickOnekeyWriteoff","click .writeoff":"onClickSingleWriteoff","click .invalid":"onClickInvalid","click .cash-flow-select":"onClickCashFlowSelect"},initialize:function(i){this.initModel(i),e.find(".voucher-business-list")},initModel:function(e){this.voucherModel=new o({detailId:e}),this.listenTo(this.voucherModel,"model:writeoff",function(e){0==e.code?location.reload():i.show(e.message)}),this.listenTo(this.voucherModel,"model:singlewriteoff",function(e){0==e.code?location.reload():i.show(e.message)}),this.listenTo(this.voucherModel,"model:invalid",function(e){0==e.code?location.reload():i.show(e.message)}),this.listenTo(this.voucherModel,"model:matchCashFlow",function(t){if(0==t.code){var n=new o(t.data);n.set("detailId",e);var c=new l({model:n});c.show()}else i.show(t.message)})},onClickSingleWriteoff:function(e){e.preventDefault();var i=$(e.target).parents("tr").data("sourceDocumentDetailid");this.voucherModel.singleWriteoff(i)},onClickOnekeyWriteoff:function(e){e.preventDefault(),this.voucherModel.writeoff()},onClickInvalid:function(e){e.preventDefault(),this.voucherModel.invalid()},onClickCashFlowSelect:function(e){e.preventDefault(),this.voucherModel.matchCashFlow()}}),l=t.extend({className:"modal fade form-modal",template:_.template($("#cashFlowSelectView").html()||"",{variable:"data"}),events:{"click [type=checkbox]":"onClickCheckbox"},initialize:function(){l.__super__.initialize.apply(this,arguments),this.active=this.$(".data-list [type=checkbox]:checked").get(0),this.listenTo(this.model,"model:connectionCashFlow",function(e){0==e.code?(i.show("流水匹配成功!正在跳转..."),setTimeout(function(){location.reload()},1e3)):i.show(e.message)})},onClickCheckbox:function(e){var i=e.target;return i.checked?(this.active&&(this.active.checked=!1),void(this.active=i)):void(this.active=null)},submitHandler:function(){var e=$(this.active).data("cashflowuuid");this.model.connectionCashFlow(e),this.hide()}});module.exports=n});