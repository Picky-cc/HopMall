define(function(require,exports,module){var t=require("scaffold/highcharts"),e=global_config.root;t.setOptions({credits:{enabled:!1},legend:{align:"right",verticalAlign:"top",y:-10},tooltip:{enabled:!1}});var n=Backbone.View.extend({el:".content",events:{"change .filter-channel":"getChannelData","change .filter-turnover":"getTurnoverData"},actions:{tradingVolumeTrend:e+"/paymentchannel/efficentanalysis/tradingVolumeTrend",statistics:e+"/paymentchannel/efficentanalysis/statistics"},initialize:function(){$(document).on("toggle.aside",function(t){this.turnoverChart.reflow(),this.channelChart.reflow()}.bind(this)),this.initTurnoverChart(),this.initChannelChart(),this.getChannelData(),this.getTurnoverData()},initTurnoverChart:function(){this.turnoverChart=new t.Chart({chart:{renderTo:this.$(".turnover .draw").get(0),marginTop:50},colors:["#69c2e2","#ed4407"],title:{text:null},plotOptions:{line:{marker:{symbol:"circle"}}},xAxis:{lineColor:"#dedede",tickLength:0,labels:{enabled:!1}},yAxis:{lineWidth:1,tickInterval:10,lineColor:"#dedede",gridLineColor:"#cdcdcd",gridLineDashStyle:"Dash",title:{text:null}}}),this.on("response:turnover",function(t){0==this.turnoverChart.series?(this.turnoverChart.addSeries({name:"付款交易额",data:t.creditAmountList}),this.turnoverChart.addSeries({name:"收款交易额",data:t.debitAmountList})):(this.turnoverChart.series[0].setData(t.creditAmountList),this.turnoverChart.series[1].setData(t.debitAmountList))})},initChannelChart:function(){var e=this.channelChart=[],n=this.$(".channel .bd"),a=function(t){var e=[];return $.isEmptyObject(t)&&(t.SUCCESS=0,t.FAIL=0,t.TIME_OUT=0,t.DOING=0,t.CREATE=1),e.push(["成功",t.SUCCESS]),e.push(["失败",t.FAIL]),e.push(["异常",t.TIME_OUT]),e.push(["处理中",t.DOING]),e.push(["等待处理",t.CREATE]),e},i={chart:{type:"pie"},colors:["#90ed7d","#f04f76","#f7a35c","#7cb5ec","#434348"],title:{text:"",verticalAlign:"bottom",y:-20,style:{fontSize:"12px"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",size:150,dataLabels:{enabled:!1}}},series:[]};this.channelChart.reflow=function(){for(var t=0;t<this.length;t++)this[t].reflow()},this.$(".channel").on("click","[data-legend-type]",function(t){var n,a=$(t.currentTarget).data("legend-type");$(e).each(function(t,e){$(this.series[0].data).each(function(t,e){e.name==a&&(n=!e.visible,e.setVisible(n))})}),n?$(t.currentTarget).removeClass("invisible"):$(t.currentTarget).addClass("invisible")}),this.on("response:channel",function(e){if(0==this.channelChart.length)for(var r=0;r<e.length;r++){var s,o=$('<div class="draw" />'),l=$.extend(!0,{},i,{chart:{renderTo:o.get(0)}});n.append(o),s=new t.Chart(l),this.channelChart.push(s)}for(var r=0;r<e.length;r++){var s=this.channelChart[r],h=e[r],c=a(h.data);0==s.series.length?s.addSeries({data:c}):s.series[0].setData(c),s.setTitle({text:h.paymentChannelName})}})},getChannelData:function(){var t=this,e={url:this.actions.statistics,dataType:"json",data:{type:this.$(".filter-channel").val()}};e.success=function(e){0==e.code&&t.trigger("response:channel",e.data.list)},$.ajax(e)},getTurnoverData:function(){var t=this,e={url:this.actions.tradingVolumeTrend,dataType:"json",data:{time:this.$(".filter-turnover").val()}};e.success=function(e){0==e.code&&t.trigger("response:turnover",e.data)},$.ajax(e)}});module.exports=n});