define(function(require,exports,module){var t=require("component/popupTip"),i=require("baseView/tableContent"),e=require("component/tab").SegmentControlView,a=require("baseView/baseFormView").FormDialogView,n=jQuery,o=global_config.root,s=a.extend({el:n("#quotaDetail").get(0),events:{"click .modify-quota":"onClickModifyQuota"},defineValidator:function(){n.validator.addMethod("rightformatAmount",function(t,i){return this.optional(i)||/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/.test(t)},"请输入正确的金额格式"),this.validator=this.$(".form").validate({rules:{transactionLimitPerTranscation:{required:!1,rightformatAmount:!0},transcationLimitPerDay:{required:!1,rightformatAmount:!0},transactionLimitPerMonth:{required:!1,rightformatAmount:!0}}})},validate:function(){return this.validator.form()},extractDomData:function(){var t=this._extractDomData(this.$(".real-value"),!0);return t.bankTransactionLimitSheetUuid=this.bankTransactionLimitSheetUuid,t},submit:function(){var i=this.extractDomData(),e={data:i,type:"post",dataType:"json",url:o+"/paymentchannel/limitSheet/update"};e.success=function(i){0==i.code?(t.show("编辑成功，正在跳转..."),setTimeout(function(){location.reload()},1e3)):t.show(i.message)},n.ajax(e)},onClickModifyQuota:function(t){this.validate()&&(this.submit(),this.hide())},initialize:function(){s.__super__.initialize.apply(this,arguments),this.segmentControl=new e({el:this.$(".segment-control").get(0)}),this.defineValidator(),this.initView()},initView:function(){this.outlierChannelName=this.model.get("outlierChannelName"),this.accountSide=this.model.get("accountSide"),this.transactionLimitPerTranscation=this.model.get("transactionLimitPerTranscation"),this.transcationLimitPerDay=this.model.get("transcationLimitPerDay"),this.transactionLimitPerMonth=this.model.get("transactionLimitPerMonth"),this.paymentInstitutionName=this.model.get("paymentInstitutionName"),this.bankName=this.model.get("bankName"),this.bankTransactionLimitSheetUuid=this.model.get("bankTransactionLimitSheetUuid"),this.$(".paymentInstitutionName").text(this.paymentInstitutionName),this.$(".outlierChannelName").text(this.outlierChannelName),this.$(".bankName").text(this.bankName),this.$(".accountSide").text(this.accountSide),this.$(".transactionLimitPerTranscation").val(this.transactionLimitPerTranscation),this.$(".transcationLimitPerDay").val(this.transcationLimitPerDay),this.$(".transactionLimitPerMonth").val(this.transactionLimitPerMonth)}}),r=a.extend({template:_.template(n("#createQuotaFormTmpl").html()),actions:{post:o+"/paymentchannel/file/upload"},events:{"change [name=file]":"onChangeFile"},resetFormElement:function(t){t.wrap("<form>").parent("form").get(0).reset(),t.unwrap()},onChangeFile:function(i){i.target.value&&!/\.xlsx?$/.test(i.target.value)&&(t.show("请上传Excel文件"),this.resetFormElement(n(i.target)))},initialize:function(){r.__super__.initialize.apply(this,arguments),this.defineValidator()},defineValidator:function(){this.validator=this.$(".form").validate({rules:{paymentInstitutionName:"required",outlierChannelName:"required",accountSide:"required"}})},validate:function(){return this.validator.form()},submit:function(){var i={url:this.actions.post,dataType:"json",type:"post"};i.success=function(i){0==i.code?(t.show("上传成功，正在跳转..."),setTimeout(function(){location.reload()},1e3)):t.show(i.message)},this.$(".form").ajaxSubmit(i)},submitHandler:function(){this.validate()&&(this.submit(),this.hide())}}),m=i.extend({events:{"click #uploadQuotaForm":"onClickUploadQuotaForm","click .modify-quota":"onClickModifyQuota"},onClickModifyQuota:function(t){t.preventDefault();var i=n(t.target).parents("tr").data(),e=i.paymentinstitutionname,a=i.outlierchannelname,o=i.accountside,r=i.transactionlimitpertranscation,m=i.transcationlimitperday,c=i.transactionlimitpermonth,l=i.bankname,u=i.banktransactionlimitsheetuuid,h=new Backbone.Model;h.set("paymentInstitutionName",e),h.set("outlierChannelName",a),h.set("accountSide",o),h.set("transactionLimitPerTranscation",r),h.set("transcationLimitPerDay",m),h.set("transactionLimitPerMonth",c),h.set("bankName",l),h.set("bankTransactionLimitSheetUuid",u);var d=new s({model:h});d.show()},onClickUploadQuotaForm:function(t){var i=new Backbone.Model,e=new r({model:i});e.show()}});module.exports=m});