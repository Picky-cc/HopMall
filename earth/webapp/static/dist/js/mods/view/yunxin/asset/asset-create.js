define(function(require,exports,module){var e=require("baseView/tableContent"),t=require("baseView/baseFormView").FormDialogView,a=require("component/popupTip"),o=(require("component/fileUpload"),jQuery),i=global_config.root,n=t.extend({template:_.template(o("#importAssertTmpl").html(),{variable:"obj"}),actions:{create:i+"/assets-package/excel-create-assetData"},events:{"change [name=file]":"onChangeFile"},initialize:function(e){n.__super__.initialize.apply(this,arguments),this.defineValidator()},resetFormElement:function(e){e.wrap("<form>").parent("form").get(0).reset(),e.unwrap()},onChangeFile:function(e){/\.xlsx?$/.test(e.target.value)||(a.show("请上传Excel文件"),this.resetFormElement(o(e.target)))},defineValidator:function(){this.validator=this.$(".form").validate({rules:{financialContractNo:"required",file:"required"}})},validate:function(){return this.validator.form()},save:function(){var e=this,t={url:this.actions.create,type:"post",dataType:"json"};t.success=function(t){a.show(t.message),e.model.trigger("create",t)},t.error=function(e){a.show("网络错误！稍后再试！")},this.$(".form").ajaxSubmit(t)},submitHandler:function(e){this.validate()&&(this.save(),this.hide())}}),s=e.extend({events:{"click .delete":"onClickDelete","click .activate":"onClickActivate","click #importAssert":"onClickImportAssert"},actions:{"delete":i+"/loan-batch/delete-loan-batch",activate:i+"/loan-batch/activate"},getDomOptions:function(e){var t=o(e).parents("tr").data();return{loanBatchId:t.id,code:t.code}},delayReload:function(e){setTimeout(function(){location.reload()},e||1e3)},onClickDelete:function(e){e.preventDefault();var t=this,i=this.getDomOptions(e.target),n=confirm("是否确认删除！"+i.loanBatchId);if(1==n){var s={type:"POST",url:this.actions["delete"],data:i,dataType:"json"};s.success=function(e){0==e.code?(a.show(e.message),t.delayReload()):a.show(e.message)},s.error=function(){a.show("网络错误！稍后再试！")},o.ajax(s)}},onClickActivate:function(e){e.preventDefault();var t=this,i=this.getDomOptions(e.target),n=confirm("是否确认激活！");if(1==n){var s={type:"POST",url:this.actions.activate,data:i,dataType:"json"};s.success=function(e){0==e.code?(a.show(e.message),t.refresh()):a.show(e.message)},s.error=function(){a.show("网络错误！稍后再试！")},o.ajax(s)}},onClickImportAssert:function(e){var t=this,a=new Backbone.Model,o=new n({model:a});a.once("create",function(e){0==e.code&&t.delayReload()}),o.show()}});module.exports=s});