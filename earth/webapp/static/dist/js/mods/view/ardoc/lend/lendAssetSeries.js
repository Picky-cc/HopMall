define(function(require,exports,module){var e=require("scaffold/util"),i=require("scaffold/path"),t=require("component/fileUploadView"),a=require("component/popupTip"),o=global_const.loadingImg.clone(),l="undefined"!=typeof FormData,n=Backbone.View.extend({el:".content",events:{"change #fileInput":"fileUploadChange","click .file-del":"fileDelete","submit #mForm":"submitHandler"},initialize:function(e){this.fileUploadView=new t({single:!0,fileFilter:[".xlsx",".xls"]}),this.listenTo(this.fileUploadView,"add:fileupload",this.fileAdd),this.formEl=this.$("#mForm"),l&&(this.ajaxSubmit=!0)},submitHandler:function(e){return this.validate()?(this.ajaxSubmit===!0&&(e.preventDefault(),this.submit()),void this.$("#submit").attr("disabled",!0)):void e.preventDefault()},validate:function(){if(!this.hadUploadFile())return a.show("请先上传文件"),!1;var e=this.$("#selProject");return e.val()?(e.removeClass("form-control-error"),!0):(e.addClass("form-control-error"),!1)},hadUploadFile:function(){var e=this.fileUploadView,i=e.single,t=e.getHadUploadFiles();return null!=t.name||!i&&!_.isEmpty(t)},submit:function(){var e=this.formEl.attr("action");if(e){var i=this,l=this.organizeFormData();this.$(".operation").append(o),t.post({url:e,data:l,success:function(e){if("0"==e.code){var i=e.data.timelineUuid,t=e.data.projectId;location.href="./submit?projectId="+t+"&timelineUuid="+i}else a.show(e.message)},complete:function(e){o.remove(),i.$("#submit").attr("disabled",!1)}})}},organizeFormData:function(){var i={},t=new FormData,a=this.$(".block-data .form-control");$.each(a,function(){$.extend(i,e.extractValueFromDifferentDom($(this)))});for(var o in i)t.append(o,i[o]);return t.append("ardocFile",this.fileUploadView.getHadUploadFiles()),t},fileDelete:function(e){var i=$(e.target),t=i.data("fileid");this.fileUploadView.deleteFile(t,function(){i.parent().remove()})},fileAdd:function(e){this.$(".had-upload").html("").append(this.createFileItemDom(e))},createFileItemDom:function(e){var i=$('<div class="item">'),t='<span class="file-name">'+e.name+"</span>";return t+='<a href="javascript: void 0;" data-fileid='+e.name+' class="file-del">删除</a>',i.html(t),i}}),s=Backbone.View.extend({el:".content",events:{"click #submit":"popopErrorDialog"},initialize:function(e){var t=this.submitSuccessDialogEl=$("#submitSuccessDialog");t.on("click","#sure",function(){location.href="./projects/"+i.parseQueryString(e).projectId+"/"});var a=this.errorDialogEl=$("#errorDialog");a.on("click","#continueSubmit",_.bind(this.submit,this))},popopErrorDialog:function(){var e=this.$("#preCheckNum").html();e=parseInt(e),e>0?this.errorDialogEl.modal():this.submit()},submit:function(){this.errorDialogEl.modal("hide");var e="./projects/submit"+location.search,i=this;$.ajax({url:e,type:"post",dataType:"json",success:function(e){"0"==e.code?i.submitSuccessDialogEl.modal():a.show(e.message)}})}});exports.LendAssetAddView=n,exports.LendAssetSubmitView=s});