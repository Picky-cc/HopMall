define(function(require,exports,module){var t=require("../../tableContent"),i=require("../recordList"),a=jQuery,e=require("scaffold/path"),s=require("component/popupTip"),c=global_config.root,o=function(t,i){var e=c+"/lend/projects/submit";a.ajax({url:e,data:t||{},type:"post",dataType:"json",success:function(t){i&&i(t)}})},n=t,d=t.extend({events:{"click .has-wrong":"popupModal","click .submit-asset":"submitBatchHandler"},initialize:function(t){this.constructor.__super__.initialize.apply(this,arguments),this.projectId=t;var i=this.dialogEl=a("#dialog");i.on("click","#goahead",_.bind(this.submit,this)).on("click","#gomodify",_.bind(this.redirect,this))},popupModal:function(t){this.curSelectedBatchId=a(t.target).parents("tr").data("batchid"),this.dialogEl.modal()},submitBatchHandler:function(t){this.curSelectedBatchId=a(t.target).parents("tr").data("batchid"),this.submit()},submit:function(){var t=this;o({projectId:this.projectId,timelineUuid:this.curSelectedBatchId},function(i){"0"==i.code?(t.dialogEl.modal("hide"),t.refresh()):s.show(i.message)})},redirect:function(){var t=this.curSelectedBatchId;if(t){var i=location.href;location.assign(e.join(i,t)+"/")}}}),r=i.extend({events:{"click #submitBatch":"submitHandler"},initialize:function(t,i,e){this.projectId=t,this.timelineUuid=i,this.batchStatus=a("#batchStatus").val(),this.constructor.__super__.initialize.apply(this,arguments),this.dialogEl=a("#dialog"),this.dialogEl.on("click","#goahead",_.bind(this.submit,this))},submitHandler:function(){this.dialogEl.modal("show")},submit:function(){var t=this;o({projectId:this.projectId,timelineUuid:this.timelineUuid},function(i){"0"==i.code?(t.dialogEl.modal("hide"),t.batchStatus="1",t.refresh(),t.$("#submitBatch").attr("disabled",!0)):s.show(i.message)})},canEdit:function(){var t,i=this.batchStatus;return t="3"!==i&&"1"!==i},configBreifListFields:function(t){var i=this,a=t.normal.slice(0,7);a.splice(3,1);var e=a;return audit=_.filter(t.audit,function(t){return"auditStatus"==t.field||"preCheckStatus"==t.field||"lastModifyTime"==t.field?!0:void 0}),e=e.concat(audit),e.push({title:"操作",formatter:function(t,a,e){return i.canEdit()&&"1"!==a.auditStatus?['<a class="modify" href="javascript:void(0)">',"修改","</a>"].join(""):['<a class="detail" href="javascript:void(0)">',"查看","</a>"].join("")}}),e}});exports.LendProjectListView=n,exports.LendProjectBatchView=d,exports.LendProjectBatchRecordView=r});