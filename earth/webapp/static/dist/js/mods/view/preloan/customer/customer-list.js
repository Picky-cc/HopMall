define(function(require,exports,module){var e=require("baseView/tableContent"),t=(require("scaffold/path"),require("component/popupTip")),i=require("baseView/baseFormView"),o=(i.FormDialogView,require("component/dialogView")),s=jQuery,n=global_config.root,a=n+"/preloan/customers/delete",r=n+"/preloan/customers/apply-project",c=e.extend({events:{"click .delete":"onClickDelete","click #submitproject":"onClickSubmit"},initialize:function(){c.__super__.initialize.apply(this,arguments),this.confirmDeleteDialog=new o({title:"删除信息",bodyInnerTxt:"客户信息一旦删除将不再恢复,是否继续?"}),this.listenTo(this.confirmDeleteDialog,"goahead",function(e){s.ajax(e),this.confirmDeleteDialog.hide()}),this.applyProjectDialog=new o({title:"提交立项",bodyInnerTxt:"对选中客户进行批量提交立项，是否继续?"}),this.listenTo(this.applyProjectDialog,"goahead",function(e){s.ajax(e),this.applyProjectDialog.hide()})},getStatus:function(e){return e.find(".status").text()},getCustomerUuid:function(e){return e.data("customer-uuid")},getItemElement:function(e){return s(e).parents("tr")},onClickDelete:function(e){e.preventDefault();var i=this,o=this.getItemElement(e.target),s=this.getStatus(o),n=this.getCustomerUuid(o);if("等待提交"==s){var r={url:a,type:"post",data:{customerUuid:n},dataType:"json"};r.success=function(e){0==e.code?i.refresh():t.show(e.message)},this.confirmDeleteDialog.show(r)}},getCheckedCustomerUuid:function(){for(var e=[],t=this.$("tbody tr .check-box:checked"),i=0;i<t.length;i++){var o=t.eq(i),s=this.getItemElement(o);e[i]=this.getCustomerUuid(s)}return e},onClickSubmit:function(e){var i=this,o=this.getCheckedCustomerUuid(),s={url:r,type:"post",data:{customerUuids:""+o},dataType:"json"};s.success=function(e){0==e.code?i.refresh():t.show(e.message)},0==o.length?t.show("请选择要提交的选项"):this.applyProjectDialog.show(s)},polish:function(e){var t={0:"等待提交",1:"等待审核",2:"立项成功",3:"立项失败"},i=e.map(function(e,i){return e.statusDesc=t[e.status]||"未定义",e});return i},collectSortParams:function(e){for(var t={},i=this.tableListEl.find("thead .sort"),o=0,n=i.length;n>o;o++){var a=i.eq(o),r=a.data("paramname"),c=a.hasClass("desc")?"DESC":a.hasClass("asc")?"ASC":"";if(r&&c){t.sortField=r,t.isAsc="ASC"===c;break}}return s.extend(e,t),e}});module.exports=c});