define(function(require,exports,module){var i=require("baseView/tableContent"),t=require("component/dialogView"),e=(require("component/popupTip"),require("./cashFlowCardView")),l=_.invert(BillConst.RepaymentAuditStatus),a=i.extend({events:{"click .expand-bill":"operateAuditView","click .regulate-bill":"operateAuditView","click .cancel-audit":"cancelAudit","click #allExpand":"allExpandHandler"},initialize:function(){a.__super__.initialize.apply(this,arguments),this.cashFlowCardViewList={};var i=this;this.cancelDialogView=new t({bodyInnerTxt:"取消对账后，系统将不为当前审计单对账，请确认"}),this.listenTo(this.cancelDialogView,"goahead",function(t){i._cancelAudit(t)}),this.on("refreshdata.tablelist",function(){i.clearBillCard(),i.$("#allExpand").html("全部展开").removeClass("expand")})},operateAuditView:function(i){i.preventDefault();var t=$(i.currentTarget),e=t.parents(".bill-item"),l=this._getOrderOptions(e);t.hasClass("expand-bill")?this.expandBill(l,e):t.hasClass("regulate-bill")&&this.regulateBill(l,e)},expandBill:function(i,t){"CREATE"===i.repaymentAuditStatus?i.mode="seem":i.mode="match";var e=this.getCashFlowCardByAuditBillId(i.auditBillUuid);e?this._foldBill(t,i):this._expandBill(t,i)},_expandBill:function(i,t){var l=this.getCashFlowCardByAuditBillId(t.auditBillUuid);return l?l:(l=new e(t),i.addClass("z-active").after(l.$el),this.setCashFlowCardWithAuditBillId(t.auditBillUuid,l),l)},_foldBill:function(i,t){i.removeClass("z-active"),this.deleteCashFlowCardByAuditBillId(t.auditBillUuid)},_cancelAudit:function(i){var t=this;t.cancelDialogView.hide(),t.refresh()},cancelAudit:function(i){i.preventDefault();var t=$(i.currentTarget),e=$.extend({},this._getOrderOptions(t.parents(".bill-item")));this.cancelDialogView.show(e)},regulateBill:function(i,t){i.mode="seem";var e=this.getCashFlowCardByAuditBillId(i.auditBillUuid);e?e.switchView(i.mode):this._expandBill(t,i)},_getOrderOptions:function(i){var t=i.data("auditbilluuid"),e=i.data("appid"),a=i.data("contractid"),d=i.find(".totalRent").html().trim(),n=l[i.find(".reconcile-status").html().trim()];if(!t)throw"no auditBillUuid";return{auditBillUuid:t,appId:e,contractId:a,totalRent:d,cashFlowItemEl:i,repaymentAuditStatus:n}},getCashFlowCardByAuditBillId:function(i){return this.cashFlowCardViewList[i]},setCashFlowCardWithAuditBillId:function(i,t){this.cashFlowCardViewList[i]=t},deleteCashFlowCardByAuditBillId:function(i){var t=this.cashFlowCardViewList,e=t[i];return e?(e.remove(),delete t[i],e):void 0},clearBillCard:function(){this.cashFlowCardViewList;this.cashFlowCardViewList={}}});exports.AuditBillsView=a});