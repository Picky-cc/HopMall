define(function(require,exports,module){var i=require("baseView/tableContent"),e=require("component/dialogView"),t=require("component/popupTip"),l=_.invert(BillConst.RepaymentStatus),a=i.extend({events:{"click .expand-bill":"operateAuditView","click .regulate-bill":"operateAuditView","click .flow-repay":"flowRepay","click #allExpand":"allExpandHandler"},initialize:function(){a.__super__.initialize.apply(this,arguments);var i=this;this.cancelDialogView=new e({bodyInnerTxt:"确认提交回款申请？"}),this.listenTo(this.cancelDialogView,"goahead",function(e){i._cancelAudit(e)}),this.on("refreshdata.tablelist",function(){i.clearBillCard(),i.$("#allExpand").html("全部展开").removeClass("expand")})},operateAuditView:function(i){i.preventDefault();var e=$(i.currentTarget),t=e.parents(".bill-item"),l=this._getOrderOptions(t);e.hasClass("expand-bill")?this.expandBill(l,t):e.hasClass("regulate-bill")&&this.regulateBill(l,t)},expandBill:function(i,e){"CREATE"===i.repaymentAuditStatus?i.mode="seem":i.mode="match";var t=this.getCashFlowCardByAuditBillId(i.auditBillUuid);t?this._foldBill(e,i):this._expandBill(e,i)},_expandBill:function(i,e){var t=this.getCashFlowCardByAuditBillId(e.auditBillUuid);return t?t:(t=new CashFlowCardView(e),i.addClass("z-active").after(t.$el),this.setCashFlowCardWithAuditBillId(e.auditBillUuid,t),t)},_foldBill:function(i,e){i.removeClass("z-active"),this.deleteCashFlowCardByAuditBillId(e.auditBillUuid)},_cancelAudit:function(i){var e=this;$.post("./flow-repay-apply",{repaymentBillUuid:i.repaymentBillUuid},function(i){i=JSON.parse(i),e.cancelDialogView.hide(),e.refresh(),0==i.code?e.refresh():t.show(i.message)})},flowRepay:function(i){i.preventDefault();var e=$(i.currentTarget),t=$.extend({},this._getOrderOptions(e.parents(".bill-item")));this.cancelDialogView.show(t)},_getOrderOptions:function(i){var e=i.data("repaymentbilluuid"),t=i.data("appid"),a=i.find(".totalRent").html().trim(),n=l[i.find(".reconcile-status").html().trim()];if(!e)throw"no repaymentBillUuid";return{repaymentBillUuid:e,appId:t,totalRent:a,cashFlowItemEl:i,repaymentStatus:n}},getCashFlowCardByAuditBillId:function(i){return this.cashFlowCardViewList[i]},setCashFlowCardWithAuditBillId:function(i,e){this.cashFlowCardViewList[i]=e},deleteCashFlowCardByAuditBillId:function(i){var e=this.cashFlowCardViewList,t=e[i];return t?(t.remove(),delete e[i],t):void 0},clearBillCard:function(){this.cashFlowCardViewList;this.cashFlowCardViewList={}}});exports.OrdinaryRepaymentView=a});