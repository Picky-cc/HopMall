define(function(require,exports,module){function t(t,i,e){n.isFunction(i)&&(e=i,i={}),n.getJSON(t,i,function(t){0==t.code?e(t.data):console.warn(t.message)})}function i(t,i){for(var e='<option value="">请选择</option>',l=0,n=t.length;n>l;l++){var c=t[l];e+='<option value="'+c.code+'">'+c.name+"</option>"}return e}function e(t,i){if(null!=i)for(var e=t.get(0).options,l=e.length-1;l>=0;l--)if(e[l].value==i){e[l].selected=!0;break}}function l(t){var i='<option value="">请选择</option>';n.isArray(t)?n.each(t,function(t,e){n(e).html(i)}):t.html(i)}var n=jQuery,c=global_config.root,s={defSelectProvince:null,defSelectCity:null,defSelectDistrict:null,actions:{provinceUrl:c+"/area/getProvinceList",cityUrl:c+"/area/getCityList",districtUrl:c+"/area/getDistrictList"}},o=Backbone.View.extend({events:{"change .province-select":"getCity","change .city-select":"getDistrict","change select":"updateValue"},initialize:function(t){this.provinceSelEl=this.$(".province-select"),this.citySelEl=this.$(".city-select"),this.districtSelEl=this.$(".district-select");var i=function(t){return{defSelectProvince:t.default_provincecode,defSelectCity:t.default_citycode,defSelectDistrict:t.default_areacode}}(this.$el.data());this.options=n.extend({},s,i,t),this.initialSelected()},initialSelected:function(){var t=this.options;this.refresh(t.defSelectProvince,t.defSelectCity,t.defSelectDistrict)},updateValue:function(){var t=this.provinceSelEl.val(),i=this.citySelEl.val(),e=this.districtSelEl.val();this.setValue(t,i,e)},setValue:function(t,i,e){var l=[];this.provinceSelEl.length>0&&l.push(t),this.citySelEl.length>0&&l.push(i),this.districtSelEl.length>0&&l.push(e),this.value=l.join("-"),this.$el.data("value",this.value)},getValue:function(){return this.value},refresh:function(t,i,l){var n=this,c=e;this.setValue(t,i,l),this.provinceSelEl.length>0&&n._getProvince(function(){c(n.provinceSelEl,t)}),t&&this.citySelEl.length>0&&n._getCity(t,function(){c(n.citySelEl,i)}),t&&i&&this.districtSelEl.length>0&&n._getDistrict(i,function(){c(n.districtSelEl,l)})},_getProvince:function(e){var l=this;t(this.options.actions.provinceUrl,function(t){l.provinceSelEl.html(i(t.provinceList,"province")),e&&e()})},_getCity:function(e,l){var n=this;t(this.options.actions.cityUrl,{provinceCode:e},function(t){n.citySelEl.html(i(t.cityList,"city")),l&&l()})},getCity:function(t){if(!(this.citySelEl.length<1)){l([this.citySelEl,this.districtSelEl]);var i=n(t.target).val();i&&this._getCity(i)}},_getDistrict:function(e,l){var n=this;t(this.options.actions.districtUrl,{cityCode:e},function(t){n.districtSelEl.html(i(t.districtList,"district")),l&&l()})},getDistrict:function(t){if(!(this.districtSelEl.length<1)){l(this.districtSelEl);var i=n(t.target).val();i&&this._getDistrict(i)}}});module.exports=o});