define(function(require,exports,module){var e=require("../../tableContent"),t=require("../recordList"),i=require("scaffold/util"),o=require("scaffold/path"),a=require("component/popupTip"),c=require("entity/ardoc/batch"),l=jQuery,s=global_config.root,n=s+"/loan/audit/",r=e.extend({events:{"click #closeAllProject":"closeAllProject"},initialize:function(){r.__super__.initialize.apply(this,arguments),this.selProjectModalEl=l("#selProDialog"),this.befCloseTipModelEl=l("#befCloseDialog"),this.befCloseTipModelEl.on("click","#goahead",_.bind(this.closeProject,this))},closeAllProject:function(e){var t=this.tableListEl.find("input[type=checkbox]:checked");t.length<1?this.selProjectModalEl.modal():this.befCloseTipModelEl.modal()},collectWannaCloseProjectId:function(){for(var e,t=this.tableListEl.find("input[type=checkbox]:checked"),i=[],o=0,a=t.length;a>o;o++)e=t.eq(o).parents("tr").data("projectid"),e&&i.push(e);return i},closeProject:function(){var e=this.collectWannaCloseProjectId();if(!(e.length<1)){var t=this;l.ajax({url:"./loan/projects/closeproject",data:{projectIdList:e.join(",")},dataType:"json",type:"post",success:function(e){"0"==e.code&&(t.refresh(),t.befCloseTipModelEl.modal("hide"))}})}}}),d=e.extend({events:{"click .close-batch":"closeBatchHandler","click .refute-batch":"refuteBatchHandler","click .gocheck":"gocheck"},initialize:function(e){d.__super__.initialize.apply(this,arguments),this.projectId=e,this.initDialog()},initDialog:function(){var e=this;this.closeTipDialog=l("#befCloseTipDialog"),this.closeTipDialog.on("click",".goahead",function(){e.closeBatch()}),this.refuteTipDialog=l("#refuteTipDialog"),this.refuteTipDialog.on("click",".goahead",function(){e.refuteBatch()}),this.haveUnCheckTipDialog=l("#haveUnCheckTipDialog"),this.haveUnCheckTipDialog.on("click",".goahead",function(){location.href=o.join(n,e.projectId,e.curSelectedBatchId+"/")})},setCurSelectedInfo:function(e){var t=e.parents("tr");this.curSelectedBatchId=t.data("batchid")},refuteBatchHandler:function(e){this.setCurSelectedInfo(l(e.target)),this.refuteTipDialog.modal()},refuteBatch:function(){var e=this;c.refute({timelineUuid:this.curSelectedBatchId,projectId:this.projectId},function(t){"0"==t.code?(e.refuteTipDialog.modal("hide"),a.show("操作成功！"),e.refresh()):a.show(t.message)})},closeBatchHandler:function(e){var t=this;this.setCurSelectedInfo(l(e.target)),c.isFinish({timelineUuid:this.curSelectedBatchId,projectId:this.projectId},function(e){"0"==e.code?t.closeTipDialog.modal():t.haveUnCheckTipDialog.modal()})},closeBatch:function(){var e=this;c.close({timelineUuid:this.curSelectedBatchId,projectId:this.projectId},function(t){"0"==t.code?(e.closeTipDialog.modal("hide"),a.show("操作成功！"),e.refresh()):a.show(t.message)})},gocheck:function(e){e.preventDefault();var t=l(e.target).parents("tr").data("batchid");location.href=o.join(n,this.projectId,t+"/")}}),h=t,f=Backbone.View.extend({el:".content",events:{"submit #mForm":"submitHandler","click [data-teamplateid]":"moveToSelTmplBox"},initialize:function(e){this.formEl=this.$("#mForm"),this.selTmplOptionalEl=this.$(".optional"),this.selTmplSelectedEl=this.$(".selected")},submitHandler:function(e){e.preventDefault(),this.validate()&&this.submit()},submit:function(){var e=this.formEl.attr("action");if(e){var t=this.organizeFormData(),i=this.$("#btnAdd");i.attr("disabled",!0),l.post("./doaddproject",t,function(e){i.attr("disabled",!1);var t=JSON.parse(e);0==t.code?location.href="../../loan":a.show(t.message)})}},validate:function(){var e,t=!0;return this.$(".basic-data .form-control").each(function(){e=i.extractValueFromDifferentDom(l(this)),e?l(this).removeClass("form-control-error"):(l(this).addClass("form-control-error"),t=!1)}),!!t},organizeFormData:function(){var e={};return this.$(".basic-data .form-control").each(function(){l.extend(e,i.extractValueFromDifferentDom(l(this)))}),e.workingSchema="",e},moveToSelTmplBox:function(e){var t=l(e.target),i=t.parent();i.hasClass("optional")?this.addToSeledtedBox(t):i.hasClass("selected")&&this.delFromSelectedBox(t)},addToSeledtedBox:function(e){if(!e.hasClass("active")){e.addClass("active");var t=e.clone();t.find(".icon").removeClass("active").addClass("cancel").html("&times;"),this.selTmplSelectedEl.append(t)}},delFromSelectedBox:function(e){e.remove();var t="[data-teamplateid="+e.data("teamplateid")+"]";this.selTmplOptionalEl.find(t).removeClass("active")}});exports.LoanProjectListView=r,exports.LoanProjectBatchView=d,exports.LoanProjectBatchRecordView=h,exports.LoanProjectEditView=f});