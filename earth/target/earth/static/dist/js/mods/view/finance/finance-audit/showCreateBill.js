define(function(require,exports,module){var t=require("component/popupTip"),e=require("baseView/baseFormView").FormDialogView,a=e.extend({template:_.template($("#showCreateBillTmpl").html(),{variable:"obj"}),className:"modal fade form-modal",events:{"change [name=keyWord]":"onChangeKeyWord"},actions:{save:"../billing-plan/leasing-bill",query_contract_info:"./query-simplified-contract-info",query_entry_type_bill_type_info:"./query-entry-type-bill-type-info"},initialize:function(t){a.__super__.initialize.apply(this,arguments),this.defineValidator()},defineValidator:function(){this.validator=this.$(".form").validate({})},validate:function(){return this.validator.form()},extractDomData:function(){var t=this._extractDomData(this.$(".real-value"),!0);return t},submitHandler:function(t){this.validate()&&(this.save(),this.hide())},save:function(){var e=this.extractDomData(),a=this.model,i={url:this.actions.save,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)};i.success=function(i){0==i.code?(e.billingPlanNumber=i.data.billingPlanNumber,a.set(e)):t.show(i.message)},$.ajax(i)},render:function(){var t=this.model.toJSON();$.extend(t,this.fetchEntryTypeAndBillType()),t.simplifedContractInfoList=this.syncFetchSimplifiedContractInfo(t.subjectMatterSourceNo),this.$el.html(this.template(t))},onChangeKeyWord:function(){var t=this,e=function(e){var a=e.data.list,i=[];for(var n in a){var o=a[n];i.push('<option value="'+o.businessContractUuid+'">'+o.contractName+"</option>")}t.$("[name=contractUuid]").html(i.join())};this.fetchSimplifiedContractInfo(!0,e)},syncFetchSimplifiedContractInfo:function(t){var e=[],a=function(t){e=t.data.list};return this.fetchSimplifiedContractInfo(!1,a,t),e},fetchSimplifiedContractInfo:function(t,e,a){var i={url:this.actions.query_contract_info,type:"get",async:t,dataType:"JSON",data:{appId:this.model.get("appId"),keyWord:t?$('[name="keyWord"]').val():a}};i.success=function(t){e&&e(t)},$.ajax(i)},fetchEntryTypeAndBillType:function(){var t={},e={url:this.actions.query_entry_type_bill_type_info,type:"get",async:!1,data:{appId:this.model.get("appId")},dataType:"JSON"};return e.success=function(e){var a=e.data.entryType,i=e.data.billType;t.entryTypeMap=a,t.billTypeMap=i},$.ajax(e),t}});module.exports=a});