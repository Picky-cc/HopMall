define(function(require,exports,module){var e=require("../../tableContent"),i=require("../recordList"),t=require("entity/ardoc/batch"),o=require("scaffold/path"),c=require("component/popupTip"),a=require("component/fileUploadView"),l=jQuery,n=global_config.root,s=e.extend({events:{"click .close-batch":"closeBatchHandler","click .refute-batch":"refuteBatchHandler"},initialize:function(){s.__super__.initialize.apply(this,arguments),this.initDialog()},initDialog:function(){var e=this;this.closeTipDialog=l("#befCloseTipDialog"),this.closeTipDialog.on("click",".goahead",function(){e.closeBatch()}),this.refuteTipDialog=l("#refuteTipDialog"),this.refuteTipDialog.on("click",".goahead",function(){e.refuteBatch()}),this.haveUnCheckTipDialog=l("#haveUnCheckTipDialog"),this.haveUnCheckTipDialog.on("click",".goahead",function(){var i=n+"/loan/audit";location.href=o.join(i,e.curSelectedProjectId,e.curSelectedBatchId+"/")})},setCurSelectedInfo:function(e){var i=e.parents("tr");this.curSelectedBatchId=i.data("batchid"),this.curSelectedProjectId=i.data("projectid")},refuteBatchHandler:function(e){this.setCurSelectedInfo(l(e.target)),this.refuteTipDialog.modal()},refuteBatch:function(){var e=this;t.refute({timelineUuid:this.curSelectedBatchId,projectId:this.curSelectedProjectId},function(i){"0"==i.code?(e.refuteTipDialog.modal("hide"),c.show("操作成功！"),e.refresh()):c.show(i.message)})},closeBatchHandler:function(e){var i=this;this.setCurSelectedInfo(l(e.target)),t.isFinish({timelineUuid:this.curSelectedBatchId,projectId:this.curSelectedProjectId},function(e){"0"==e.code?i.closeTipDialog.modal():i.haveUnCheckTipDialog.modal()})},closeBatch:function(){var e=this;t.close({timelineUuid:this.curSelectedBatchId,projectId:this.curSelectedProjectId},function(i){"0"==i.code?(e.closeTipDialog.modal("hide"),c.show("操作成功！"),e.refresh()):c.show(i.message)})}}),h="undefined"!=typeof FormData,d=i.extend({events:{"click #closeBatch":"closeBatchHandler","click #refuteBatch":"refuteBatchHandler"},initialize:function(e,i){d.__super__.initialize.apply(this,arguments),this.projectId=e,this.timelineUuid=i,this.initDialog(),this.fileUploadView=new a({single:!0,fileFilter:[".xlsx",".xls"]}),this.listenTo(this.fileUploadView,"add:fileupload",this.fileAdd),this.fileUpFromEl=this.$("#fileUpFrom"),h&&global_helperObj.appendFormParams({projectId:this.projectId,timlineId:this.timelineUuid},this.fileUpFromEl[0])},initDialog:function(){var e=this;this.closeTipDialog=l("#befCloseTipDialog"),this.closeTipDialog.on("click",".goahead",function(){e.closeBatch()}),this.refuteTipDialog=l("#refuteTipDialog"),this.refuteTipDialog.on("click",".goahead",function(){e.refuteBatch()}),this.haveUnCheckTipDialog=l("#haveUnCheckTipDialog")},fileAdd:function(e){var i=this,t=n+"/loan/import-excel";if(h){var o=new FormData;o.append("projectId",this.projectId),o.append("timlineId",this.timelineUuid),o.append("ardocFile",this.fileUploadView.getHadUploadFiles()),a.post({url:t,data:o,success:function(e){"0"==e.code?(c.show("文件上传成功"),i.refresh()):c.show(e.message)}})}else this.fileUpFromEl.submit()},succCallback:function(e){this[e+"TipDialog"].modal("hide"),c.show("操作成功！正在跳转..."),setTimeout(function(){location.href=n+"/loan/audit"},1e3)},refuteBatch:function(){var e=this;t.refute({timelineUuid:this.timelineUuid,projectId:this.projectId},function(i){"0"==i.code?e.succCallback("refute"):c.show(i.message)})},refuteBatchHandler:function(){this.refuteTipDialog.modal()},closeBatchHandler:function(){var e=this;t.isFinish({timelineUuid:this.timelineUuid,projectId:this.projectId},function(i){"0"==i.code?e.closeTipDialog.modal():e.haveUnCheckTipDialog.modal()})},closeBatch:function(){var e=this;t.close({timelineUuid:this.timelineUuid,projectId:this.projectId},function(i){"0"==i.code?e.succCallback("close"):c.show(i.message)})},configBreifListFields:function(e){var i=e.normal.slice(0,7);i.splice(3,1);var t=i;return audit=_.filter(e.audit,function(e){return"auditStatus"==e.field||"preCheckStatus"==e.field?!0:void 0}),t=t.concat(audit),t.push({title:"操作",formatter:function(e,i,t){var o='<a class="modify" href="javascript:void(0)" title="审核">'+("0"===i.auditStatus?"审核":"重新审核")+"</a>";return o}}),t}});exports.LoanCheckListView=s,exports.LoanCheckBatchRecordView=d});