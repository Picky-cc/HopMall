define(function(require,exports,module){var t=require("../../entity/ardoc/ardoc"),e=require("../../entity/ardoc/arDocStructure").ARDocTotalStructure,i=t.ARRecordModel,r=require("../tableContent"),a=require("./recordDetail"),n=jQuery,o=n("body"),s=function(t){var e=_.map(t,function(t){var e=new i(t);return e.extractDataToColumns()});return e},l={0:"待审核",1:"已通过",2:"不通过"},d={0:"格式正确",1:"格式错误"},c=r.extend({events:{"click .detail":"showDetailNoEdit","click .modify":"showDetailEdit"},initialize:function(t,e,i){c.__super__.initialize.apply(this,arguments),this.recordListArea=this.tableListEl,this.initialDocumentSchema(i),this.intialRecord(t,e),this.initRecordBreifListArea(),this.initialDetailView(),this.getFirstPageData()},intialRecord:function(t,e){this.model=new i({},{projectId:t,batchId:e,structure:this.structure});var r=this;this.listenTo(this.model,"change",function(t){r.recordListArea.bootstrapTable("updateRow",{index:t.tableRowIndex,row:n.extend(t.extractDataToColumns(),{modified:!0})})})},initialDocumentSchema:function(t){this.structure=new e(t,{createDetailViewTmpl:n("#blockTmpl")})},initialDetailView:function(){this.detailView=new a({model:this.model,structure:this.structure}),this.detailView.on("nextmodel",_.bind(this.selectItem,this)),this.detailView.render()},processColumns:function(t){n.each(t.audit,function(t,e){"auditStatus"===e.field?e.formatter=function(t,e,i){return l[t]}:"preCheckStatus"===e.field&&(e.formatter=function(t,e,i){return d[t]})});var e=t.normal,i={lessee:"20%"},r=e.length;for(var a in i)for(var o=i[a],s=0;r>s;s++)if(e[s].field===a)return void(e[s].width=o);t.normal.unshift({title:"序号",formatter:function(t,e,i){return i+1}})},_configBreifListFields:function(){var t=this.structure.extractColumnsForTablePlugins();this.processColumns(t);var e=this.configBreifListFields(t);return e},configBreifListFields:function(t){var e=t.normal.slice(0,5),i=_.filter(t.audit,function(t){return"auditStatus"==t.field||"preCheckStatus"==t.field?!0:void 0});return e=e.concat(i),e.push({title:"操作",formatter:function(t,e,i){return['<a class="detail" href="javascript:void(0)" title="详情">',"查看","</a>"].join("")}}),e},initRecordBreifListArea:function(){var t={classes:"table-no-bordered",pagination:!1,pageSize:12,escape:!0,idField:"id",rowStyle:function(){return{classes:"record-item"}},rowAttributes:function(t,e){return{"data-recordid":t.rowIndex}}},e=this._configBreifListFields();this.recordListArea.bootstrapTable(_.extend({},t,{columns:e}))},refreshTableDataList:function(t){var e=s(t);this.recordListArea.bootstrapTable("load",e)},selectItem:function(t){var e,i=this.recordListArea.find(".record-item"),r=i.filter(".active");switch(t){case 37:e=r.length>0?r.prev():i.last();break;case 39:e=r.length>0?r.next():i.first()}e&&e.find(".detail").click()},showDetailNoEdit:function(t){this.setDetailViewDisplayMode("noedit"),this.showDetail(t)},showDetailEdit:function(t){this.setDetailViewDisplayMode("edit"),this.showDetail(t)},setDetailViewDisplayMode:function(t){this.detailView.setDisplayMode(t||"edit")},showDetail:function(t){this.recordListArea.find(".record-item").removeClass("active");var e=this.detailView,i=n(t.target).parents(".record-item").addClass("active"),r=i.data("index"),a=i.data("recordid");if(null==a&&(a=n(t.target).data("recordid")),null==a){var s=this.pageControl.getCurrentPageIndex();a=12*(s-1)+r}e.attachToDomTree(o),this.model.set({id:a},{silent:!0}),this.model.tableRowIndex=r,this.model.fetch({silent:!0})}});module.exports=c});