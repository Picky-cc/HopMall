define(function(require,exports,module){var t=require("../../tableContent"),e=(require("../recordList"),require("scaffold/util")),a=require("component/popupTip"),i=require("entity/ardoc/arDocStructure").ARDocBlockStructure,n=t.extend({initialize:function(){n.__super__.initialize.apply(this,arguments),this.setPageControl({url:"/",totalPageNum:11})}}),l=t.extend({initialize:function(t,e){l.__super__.initialize.apply(this,arguments),this.setPageControl({url:"/",totalPageNum:1}),shcemaObj=JSON.parse(e),this.structure=new i(shcemaObj),this.generateListFields(),this.fillTableData()},generateListFields:function(){var t={pagination:!1,pageSize:10,idField:"id"};t.columns=[{title:"序号",formatter:function(t,e,a){return a+1}},{title:"字段名称",field:"displayName"},{title:"字段类型",field:"dataType"},{title:"可空",field:"isnull"},{title:"备注",field:"remark"}],this.tableListEl.bootstrapTable(t)},fillTableData:function(){var t=this.structure.getColumn();this.tableListEl.bootstrapTable("load",t)}}),r=['<td><input data-paramname="displayName" type="text" class="form-control" placeholder="请输入字段名称"></td>',"                          <td>",'                            <select data-paramname="dataType" class="form-control">','                              <option value="number">数字</option>','                              <option value="string">字符串</option>',"                            </select>","                          </td>",'                          <td><input data-paramname="allowNull" class="form-control" type="checkbox">是</td>','                          <td><input data-paramname="remark" type="text" class="form-control"></td>','                          <td><a href="javascript: void 0;" class="del-field-btn">删除</a></td>'].join(""),o=$('<tr class="field-item">').html(r),s=Backbone.View.extend({el:".content",events:{"submit #mForm":"submitHandler","click .del-field-btn":"delTemplateFieldItem","click .add-field-btn":"addTemplateFiledItem"},initialize:function(){this.defineTemplateEl=this.$(".define-template"),this.formEl=this.$("#mForm")},submitHandler:function(t){t.preventDefault(),this.validate()&&this.submit()},validate:function(){var t=this.$('[data-paramname="name"]');if(!t.val())return t.addClass("form-control-error"),!1;t.removeClass("form-control-error");var e=this.generateTmplStructure();return e.getColumn().length<1?(a.show("请先填写一个模版字段"),!1):!0},submit:function(){var t=this.formEl.attr("action");if(t){var e=this.organizeFormData();$.ajax({type:"post",data:e,dataType:"json",url:t,success:function(t){}})}},delTemplateFieldItem:function(t){t.preventDefault(),$(t.target).parents(".field-item").remove()},addTemplateFiledItem:function(t){t.preventDefault();for(var e=this.$(".add-field-num").val()||0;e-- >0;)this.defineTemplateEl.append(o.clone())},organizeFormData:function(){var t={};this.$(".basic-data .form-control").each(function(){$.extend(t,e.extractValueFromDifferentDom($(this)))});var a=this.generateTmplStructure();a.set({uuid:_.uniqueId(),name:t.name}),console.log(JSON.stringify(a.toJSON()))},generateTmplStructure:function(){var t,e=this,a=new i;return this.defineTemplateEl.find(".field-item").each(function(){t=e._extractFieldData($(this)),t.displayName&&a.addColumn(t)}),a},_extractFieldData:function(t){var a,i={};return t.find(".form-control").each(function(){a=e.extractValueFromDifferentDom($(this)),$.extend(i,a)}),i.uuid=_.uniqueId(),i.interalName="",i.matchPatterns="",i}});exports.LoanTemplateListView=n,exports.LoanTemplateDetailView=l,exports.LoanTemplateEditView=s});