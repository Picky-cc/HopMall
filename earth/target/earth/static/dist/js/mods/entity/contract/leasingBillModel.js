define(function(require,exports,module){var t=jQuery,i=Backbone.Model.extend({discardAction:"./batch-close-bills",deleteAction:"./batch-delele-bills",modifyDiscountAction:"./disconunt-update",defaults:{discountInfo:{}},initialize:function(t,i){this.isCheck=!1,this.display=!0},isPayOff:function(){var t=this.get("receivedAmount"),i=this.get("amount");return 0==t||t===i},modifyDiscount:function(i,e){var n=t.proxy(function(t){0==t.code&&this.set({discountInfo:i,amount:this.get("carringAmount")-i.amount})},this),e={url:this.modifyDiscountAction,dataType:"json",type:"post",data:t.extend({billUuid:this.get("billUuid")},i),success:n};t.ajax(e)},discard:function(i){var e=t.proxy(function(t){0==t.code&&this.set({billStatusDescription:"关闭",billStatus:3}),i&&i(t)},this),n={url:this.discardAction,dataType:"json",type:"post",data:{billingPlanUuidList:JSON.stringify([this.get("billUuid")])},success:e};t.ajax(n)},remove:function(i){var e=t.proxy(function(t){0==t.code&&this.destroy(),i&&i(t)},this),n={url:this.deleteAction,dataType:"json",type:"post",data:{billingPlanUuidList:JSON.stringify([this.get("billUuid")])},success:e};t.ajax(n)},execCheckByItem:function(t){this.isCheck=t,this.trigger("togglecheck:item",t)},execCheckByAll:function(t){this.isCheck=t,this.trigger("togglecheck:all",t)},execDisplay:function(t){this.display=t,this.trigger("display",t)}}),e=Backbone.Collection.extend({url:"./query-stage-bill",deleteBatchAction:"./batch-delele-bills",discardBatchAction:"./batch-close-bills",model:i,initialize:function(t){},toggleCheck:function(t,i){this.each(function(e,n){e.get("_uiType")===i&&e.execCheckByAll(t)})},filterCheck:function(t){return this.filter(function(i){return i.get("_uiType")===t?i.isCheck:void 0})},isAllPayOff:function(t){for(var i=!0,e=0,n=t.length;n>e&&(i=t[e].isPayOff(),i);e++);return i},discards:function(i){for(var e=[],n=0,s=i.length;s>n;n++)e.push(i[n].get("billUuid"));var l=t.proxy(function(t){if(0==t.code)for(var n=0,s=e.length;s>n;n++)i[n].set({billStatusDescription:"关闭",billStatus:3})},this),c={url:this.discardBatchAction,dataType:"json",type:"post",data:{billingPlanUuidList:JSON.stringify(e)},success:l};t.ajax(c)},deletes:function(i){for(var e=[],n=0,s=i.length;s>n;n++)e.push(i[n].get("billUuid"));var l=t.proxy(function(t){if(0==t.code)for(var n=0,s=e.length;s>n;n++)i[n].destroy()},this),c={url:this.deleteBatchAction,dataType:"json",type:"post",data:{billingPlanUuidList:JSON.stringify(e)},success:l};t.ajax(c)},parse:function(t){return 0==t.code?(this.creditStageBills=t.data.creditStageBills.map(function(t,i){return t._uiType="credit",t._index=i,t}),this.debitStageBills=t.data.debitStageBills.map(function(t,i){return t._uiType="debit",t._index=i,t}),[].concat(this.creditStageBills,this.debitStageBills)):void console.error(t.message)}});exports.BillingPlanModel=i,exports.BillingPlanCollection=e});