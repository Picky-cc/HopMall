define(function(require,exports,module){var r=Array.prototype.slice,e=function(r,t){var a=/^\.\.\//,n=/^\.\//;return n.test(t)?(r=r.replace(/[^\/]*$/,""),t=t.replace(n,""),e(r,t)):a.test(t)?(r=r.slice(0,r.lastIndexOf("/")),t=t.replace(a,"./"),e(r,t)):r+"/"+t},t={};t.join=function(){for(var t=r.call(arguments,0),a=t.shift();t.length>0;)a=e(a,t.shift());return a=a.replace(/\/{2,}/g,"/")},t.basename=function(){},t.extname=function(r){var e=r.lastIndexOf(".");return-1===e?"":r.slice(e,r.length)},t.parseQueryString=function(r){var e=[],t={};return e="?"===r[0]?r.slice(1).split("&"):r.split("&"),e.forEach(function(r,e,a){var n,s=r.split("=");try{n=JSON.parse(s[1])}catch(u){n=s[1]}t[s[0]]=n}),t},t.stringifyQueryObject=function(r){var e=[];for(var t in r)e.push(t+"="+r[t]);return e.join("&")},t.parse=function(r,e){var a={hash:null,search:null,query:null,path:null,href:r};a.path=r.split(/[#\?]/)[0];var n=r.replace(a.path,"");if("?"===n[0]){var s=n.split("#");a.search=s[0],a.query=a.search.slice(1),s[1]&&(a.hash="#"+s[1])}else"#"===n[0]&&(a.hash=n);return e&&a.search&&(a.query=t.parseQueryString(a.search)),a},t.format=function(r){var e={path:"/",query:null,hash:null},t=$.extend({},e,r),a=[t.path];if(t.query){var n=this.stringifyQueryObject(t.query);a.push("?"+n)}t.hash&&a.push("#"===t.hash[0]?t.hash:"#"+t.hash);var s=a.join("");return s.replace(/\/{2, }/g,"/").replace("(?.*)?",function(r,e){return e+"&"})},module.exports=t});